### YML configuration templates examples

```YML Build Base template config
#################################################
# Properties processed from the request form
#################################################
alias: alz-vending-cesar-dev
display_name: sub name prefix Cesar DEV
subscription_id: d200e3b2-c0dc-4076-bd30-xxxxxxx (note; use property when Subscription exist)
request_id: auto-generated
global_id: cesar
project_name: my new cesar project
environment: Automation Cloud
subscription_configuration: DEV, STG, PRD
application_workload_name: cesar
geographic_area: us
default_resource_groups: true
request_custom_resource_groups: false
workload_type: IaaS
security_zone: MG-INTRANET
network_peering: true
confidential_data_classification: false
team_name: cesar team
tags:
  Application: cesar
  BusinessStream: cesar
  CostCenter: 123456
  Customer: cesar
  UserGroup: cesar
contact_email_address: requestor.owner@domain.com
alternative_email_addresses:
  - team1@domain.com
  - email2@domain.com
azure_devOps_project_URLs: https://cesar.com

# Security 
subscription_management_group_id: MG-INTRANET
subscription_management_group_association_enabled: false

resource_group_creation_enabled: false
resource_groups: 
 default_rg_west:  # Static values
    name: azr-abcde-rg-0001 # build dynamic per naming convention
    location: centralus 
 default_rg_east:  # Static values
    name: azc-abcde-rg-0001 # build dynamic per naming convention
    location: westus

role_assignment_enabled: false
role_assignments:
  my_assignment_1:
    principal_id: 1ee19a21-5de3-486a-8156-xxxxxxxxx # group id
    definition: Owner
    relative_scope: ''
  my_assignment_2:
    principal_id: 1ee19a21-5de3-486a-8156-xxxxxxxxx # group id
    definition: Reader
    relative_scope: ''
  my_assignment_3:
    principal_id: 1ee19a21-5de3-486a-8156-xxxxxxxxx # group id
    definition: Reader
    relative_scope: ''

aad_groups:
  owner: 1ee19a21-5de3-486a-8156-xxxxxxx 
  team: 1ee19a21-5de3-486a-8156-xxxxxxx 
  reader: 1ee19a21-5de3-486a-8156-xxxxxxx 

# network
virtual_network_enabled: false # when peering is enabled - true
virtual_networks:
  vnet1:
    name: azl-abcde-vnet-0001 # build dynamic per naming convention
    address_space:
      - 192.168.21.0/24
    dns_servers: 
      - 10.0.0.1 # Static values
      - 10.0.0.2 # Static values
    resource_group_name: azl-abcde-centralus-rg-0001 # build dynamic per naming convention
    location: centralus # Static values
    hub_peering_enabled: true # Static values
    hub_network_resource_id : /subscriptions/d200e3b2-c0dc-4076-bd30-xxxxxxx /resourceGroups/cesart10-connectivity-centralus/providers/Microsoft.Network/virtualNetworks/cesart10-hub-centralus
    hub_peering_use_remote_gateways : false # Static values
  vnet2:
    name: azl-abcde-vnet-0002 # build dynamic per naming convention
    address_space:
      - 192.168.22.0/24 # generated by InfoBlox at during network repo build. 
    dns_servers: 
      - 10.0.0.1 # Static values
      - 10.0.0.2 # Static values
    resource_group_name: azl-abcde-westus-rg-0002 # build dynamic per naming convention
    location: westus # Static values
    hub_peering_enabled: true # Static values
    hub_network_resource_id : /subscriptions/d200e3b2-c0dc-4076-bd30-xxxxxxx /resourceGroups/cesart10-connectivity-westus/providers/Microsoft.Network/virtualNetworks/cesart10-hub-westus
    hub_peering_use_remote_gateways : false # Static values

# postConfig
budget_creation_enabled: false
budgets:
  budget:
    budget_name: alz-vending-cesar-dev
    budget_amount: 8000
    budget_occurrence: Monthly
    budget_threshold: 800
    budget_notification_emails: 
health_alerts_enabled: false

#################################################
```

```YML Vending config
#################################################
# Current required fields for the vending process
#################################################
billing_account_lookup_key: default
enrollment_account_lookup_key: azure-local-admin
alias: alz-vending-tacos-dev
display_name: sub name prefix tacos dev
workload: Production
location: centralus
override_default_role_assignments: false
role_assignments:
- principal_id: []
app_reg_name: DevOps-tacosDEV-ServiceConnection
global_id: tacos
tags: 

#################################################
```

```YML security config
#################################################
# Current required fields for the vending process
#################################################
request_custom_resource_groups: false
project_name: my new cesar project
subscription_id: d200e3b2-c0dc-4076-bd30-xxxxxxxxx
contact_email_address: requestor.owner@domain.com
resource_group_creation_enabled: true
azure_devOps_project_URLs: https://cesar.com
team_name: cesar team
security_zone: MG-INTRANET
global_id: cesar
tags:
  CostCenter: 123456
  Customer: cesar
  UserGroup: cesar
  Application: cesar
  BusinessStream: cesar
confidential_data_classification: false
application_workload_name: cesar
subscription_management_group_id: MG-INTRANET
alias: alz-vending-cesar-dev
alternative_email_addresses:
- team1@domain.com
- email2@domain.com
resource_groups:
  default_rg_east:
    name: azc-abcde-rg-0001
    location: westus
  default_rg_west:
    name: azr-abcde-rg-0001
    location: centralus
role_assignments:
  my_assignment_3:
    definition: Reader
    relative_scope: ""
    principal_id: 1ee19a21-5de3-486a-8156-xxxxxxxx
  my_assignment_1:
    definition: Owner
    relative_scope: ""
    principal_id: 1ee19a21-5de3-486a-8156-xxxxxxxx
  my_assignment_2:
    definition: Reader
    relative_scope: ""
    principal_id: 1ee19a21-5de3-486a-8156-xxxxxxxx
display_name: sub name prefix Cesar dev
environment: Automation Cloud
subscription_management_group_association_enabled: true
subscription_configuration: DEV, STG, PRD
network_peering: true
geographic_area: us
role_assignment_enabled: true
workload_type: storage
request_id: auto-generated
aad_groups:
  reader: 1ee19a21-5de3-486a-8156-xxxxxxxx
  owner: 1ee19a21-5de3-486a-8156-xxxxxxxx
  team: 1ee19a21-5de3-486a-8156-xxxxxxxx
default_resource_groups: true
#################################################
```

```YML network config
alias: alz-vending-tacos-dev
display_name: sub name prefix tacos dev
request_id: auto-generated
global_id: tacos
project_name: my new tacos project
environment: Automation Cloud
environment_subtype: dev
network_peering: true
network_size: xsmall
confidential_data_classification: false
team_name: tacos team
tags:
  Application: tacos
  BusinessStream: tacos
  CostCenter: 123456
  Customer: tacos
  UserGroup: tacos
contact_email_address: requestor.owner@domain.com
alternative_email_addresses:
  - team1@domain.com
  - email2@domain.com
azure_devOps_project_URLs: https://tacos.com

virtual_network_enabled: true
virtual_networks:
  primary_location:
    name: vnet-azr-us-tacosautomation cloud
    address_space:
      - SET_MANUALLY
    dns_servers:
      - 10.26.165.10
      - 10.26.165.11
      - 10.30.165.10
      - 148.89.233.135
    resource_group_name: RG-US-NET-tacosAUTOMATION CLOUD-AZR
    location: centralus
    hub_peering_enabled: true
    hub_network_resource_id: /subscriptions/1aa0508f-717b-4f3d-9cf8-baf4cede3d40/resourceGroups/RG-US-NET-HUB-AZR/providers/Microsoft.Network/virtualNetworks/vnet-azr-us-hub
    hub_peering_use_remote_gateways: false
    route_tables:
      default:
        name: rt-azr-us-tacos-internal
        routes:
          - name: default
            address_prefix: 0.0.0.0/0
            next_hop_type: VirtualAppliance
            next_hop_in_ip_address: 10.42.1.4
    subnets: []
    tags:
      Application: tacos
      BusinessStream: tacos
      CostCenter: 123456
      Customer: tacos
      UserGroup: tacos
  secondary_location:
    name: vnet-azc-us-tacosautomation cloud
    address_space:
      - SET_MANUALLY
    dns_servers:
      - 10.30.165.10
      - 10.30.165.11
      - 10.26.165.10
      - 148.89.233.135
    resource_group_name: RG-US-NET-tacosAUTOMATION CLOUD-AZC
    location: westus
    hub_peering_enabled: true
    hub_network_resource_id: /subscriptions/1aa0508f-717b-4f3d-9cf8-baf4cede3d40/resourceGroups/RG-US-NET-HUB-AZC/providers/Microsoft.Network/virtualNetworks/vnet-azc-us-hub
    hub_peering_use_remote_gateways: false
    route_tables:
      default:
        name: rt-azc-us-tacos-internal
        routes:
          - name: default
            address_prefix: 0.0.0.0/0
            next_hop_type: VirtualAppliance
            next_hop_in_ip_address: 10.42.1.4
    subnets: []
    tags:
      Application: tacos
      BusinessStream: tacos
      CostCenter: 123456
      Customer: tacos
      UserGroup: tacos

#################################################
```

```YML postConfig config
#################################################
# Current required fields for the vending process
#################################################
project_name: my new tacos project
application_workload_name: tacos
geographic_area: us
tags:
  Application: tacos
  Customer: tacos
  BusinessStream: tacos
  UserGroup: tacos
  CostCenter: 123456
health_alerts_enabled: true
subscription_id: d200e3b2-c0dc-4076-bd30-xxxxxx
subscription_configuration: DEV, STG, PRD
environment: Automation Cloud
alternative_email_addresses:
- team1@domain.com
- email2@domain.com
request_custom_resource_groups: false
workload_type: IaaS
azure_devOps_project_URLs: https://tacos.com
team_name: tacos team
contact_email_address: requestor.owner@domain.com
budgets:
  budget:
    name: alz-vending-tacos-PRD
    amount: 8000
    time_grain: Monthly
    threshold: 5000 # when to alert
    contact_groups:
      - email1@domain.com
      - email2@domain.com
security_zone: MG-INTRANET
display_name: sub name prefix tacos DEV
monthly_budget_amount:
  '': 
aad_groups:
  owner: xxxxx-xxxxx-xxxx-xxxx
  team: xxxxx-xxxxx-xxxx-xxxx
  reader: xxxxx-xxxxx-xxxx-xxxx
default_resource_groups: true
global_id: tacos
network_peering: true
confidential_data_classification: false
request_id: auto-generated
alias: alz-vending-tacos-dev
budget_creation_enabled: true

#################################################
```

### Repo folder/file structure

```plaintext pattern 1 - single code review - Security, network, cloudOps ability to review/approve code and deployment
|-- workload

|   |-- requests
|   |   |-- [global_id=wTacos]
|   |   |   |_ request.json
|   |   |-- [global_id=wBurgers]
|   |   |   |_ request.json
|   |   |-- [global_id=wSoups]
|   |   |   |_ request.json

|   |-- subscriptions
|   |   |-- [global_id=wTacos]
|   |   |   |_ sub-[global_id=wTacos]-dev.yml 
|   |   |   |_ sub-[global_id=wTacos]-stg.yml
|   |   |   |_ sub-[global_id=wTacos]-prd.yml
|   |   |-- [global_id=wBurgers]
|   |   |   |_ sub-[global_id=wBurgers]-dev.yml 
|   |   |   |_ sub-[global_id=wBurgers]-stg.yml
|   |   |   |_ sub-[global_id=wBurgers]-prd.yml
|   |   |-- [global_id=wSoups]
|   |   |   |_ sub-[global_id=wSoups]-dev.yml 
|   |   |   |_ sub-[global_id=wSoups]-stg.yml
|   |   |   |_ sub-[global_id=wSoups]-prd.yml
|   |   |_  etc....

|   |-- builds
|   |   |-- [global_id=wTacos]
|   |   |   |-- lib
|   |   |   |   |_ sub-[global_id=wTacos]-dev.yml 
|   |   |   |   |_ sub-[global_id=wTacos]-stg.yml
|   |   |   |   |_ sub-[global_id=wTacos]-prd.yml
|   |   |-- [global_id]=wBurgers
|   |   |   |-- lib
|   |   |   |   |_ sub-[global_id=wBurgers]-dev.yml 
|   |   |   |   |_ sub-[global_id=wBurgers]-stg.yml
|   |   |   |   |_ sub-[global_id=wBurgers]-prd.yml
|   |   |-- [global_id=wSoups]
|   |   |   |-- lib
|   |   |   |   |_ sub-[global_id=wSoups]-dev.yml 
|   |   |   |   |_ sub-[global_id=wSoups]-stg.yml
|   |   |   |   |_ sub-[global_id=wSoups]-prd.yml
|-- terraform
|   |-- shared resource
|   |   |-- module

```

### example form

```plaintext example form
requestid: auto-generated
Full workload/project name: my new abcde project
Workload name/id: abcde
Number of Environments: 0002(subs), 0003(subs), 0005(subs)
app resource groups: rg1, rg2
Region location: eastus
Workload archetype: PaaS - (IaaS, PaaS, hybrid, Analytics)
Network zone: intranet
virtual network required: yes
Network peering: yes
Data type / sensitive: no
PCI: no
Team Name: abcde tea
Cost Center ID: 123456
AAD group 'object id': xxxxx-xxxxx-xxxx-xxxx
Email for notifications: requestor.owner@domain.com
Team distribution list: team1@domain.com
```

### Artifacts, Process and Steps Input/Outputs Mapping

```plaintext process

GHE action workflows and scripts
    - creates running branch and push to remote. name IE: `FEATURE/VENDNING/[global_id]`
    - Create PR for running branch
    - runs script to parse and save json file
        - `/workload/request/[global_id]/request.json`
    - runs script/steps or calls another workflow to save subscription create YML file based on request.json
    - runs script/steps or calls another workflow to save resource creation YML file based on request.json
    - runs script/steps or calls another workflow to deploy subscription into the environment
    - runs script/steps or calls another workflow to deploy core infra resources into each created subscription
        - security, network, post config
Create a request form with all required inputs from consumers
    - manual or CI trigger GHE workflow to save request.json
    - `/workload/request/[global_id]/request.json`

Create a set of yml files based on a template named as workload name [global_id] 
    - IE: `sub-[global_id]-dev.yml`, `sub-[global_id]-stg.yml`, `sub-[global_id]-prd.yml`  
Fill-in each yml files required input from output taken from the request form  
Create a set of yml files to create each subscription requested  
    - `/workload/subscriptions/[global_id]`  
    - IE: `sub-[global_id]-dev.yml`, `sub-[global_id]-stg.yml`, `sub-[global_id]-prd.yml`  
Create a set of files to deploy core resources to each subscription. Note: this is only required if a decision is made to separate subscription creation with core resource deployment. This is ideal when separate accounts/SPNs should be used for each task due to the permission required for each.  
    - `/workload/build/[global_id]`  
    - IE: `sub-[global_id]-dev.yml`, `sub-[global_id]-stg.yml`, `sub-[global_id]-prd.yml`  
Create one bootstrap GH action workflow  
    - the workflow will take at least one parameter `[global_id]` to identify and locate which request to process  
terraform backend state, each request will create one state file that stores all the deployed resources  
    - `storage account/container/[global_id]/[global_id].tfstate`

Initial runs would be manual.

options for integration:
    - a branch name as the [global_id] is created in each repo
    - a bootstrap workflow/pipeline is trigger and parses the global id based on the branch name
    - The bootstrap workflow runs do do the deployment and configurations of resources

```

#### resoruces

Components
Security
	Default resource groups
	Role assignment
	Management group
Network
	Virtual network
	Subnets
	Peering
	NSG
	Rout table
PostConfig
	App resources groups
	Logging
	default health Alerts
	Budgets


### extended patterns

```plaintext pattern 2 - separate review - Security, network, cloudOps ability to review/approve code and deployment
|-- workload

|   |-- **requests**
|   |   |-- [global_id]=wTacos
|   |   |   |_ request.json
|   |   |-- [global_id]=wBurgers
|   |   |   |_ request.json
|   |   |-- [global_id]=wSoups
|   |   |   |_ request.json

|   |-- **subscription**
|   |   |_ sub-[global_id=wTacos]-dev.yml 
|   |   |_ sub-[global_id=wTacos]-stg.yml
|   |   |_ sub-[global_id=wTacos]-prd.yml
|   |   |_ sub-[global_id=wBurgers]-dev.yml 
|   |   |_ sub-[global_id=wBurgers]-stg.yml
|   |   |_ sub-[global_id=wBurgers]-prd.yml
|   |   |_ sub-[global_id=wSoups]-dev.yml 
|   |   |_ sub-[global_id=wSoups]-stg.yml
|   |   |_ sub-[global_id=wSoups]-prd.yml
|   |   |_  etc....

|   |-- **build**
|   |   |-- **security**
|   |   |   |-- [global_id]=wTacos
|   |   |   |   |-- lib
|   |   |   |   |   |_ sub-[global_id=wTacos]-dev.yml 
|   |   |   |   |   |_ sub-[global_id=wTacos]-stg.yml 
|   |   |   |   |   |_ sub-[global_id=wTacos]-prd.yml 
|   |   |   |-- [global_id]=wBurgers
|   |   |   |   |-- lib
|   |   |   |   |   |_ sub-[global_id=wBurgers]-dev.yml 
|   |   |   |   |   |_ sub-[global_id=wBurgers]-stg.yml
|   |   |   |   |   |_ sub-[global_id=wBurgers]-prd.yml

|   |   |   |-- [global_id]=wSoups
|   |   |   |   |-- lib
|   |   |   |   |   |_ sub-[global_id=wSoups].yml 
|   |   |   |   |   |_ sub-[global_id=wSoups].yml
|   |   |   |   |   |_ sub-[global_id=wSoups].yml

|   |   |-- **network**
|   |   |   |-- [global_id]=wTacos
|   |   |   |   |-- lib
|   |   |   |   |   |_ sub-[global_id=wTacos]-dev.yml 
|   |   |   |   |   |_ sub-[global_id=wTacos]-stg.yml 
|   |   |   |   |   |_ sub-[global_id=wTacos]-prd.yml 
|   |   |   |-- [global_id]=wBurgers
|   |   |   |   |-- lib
|   |   |   |   |   |_ sub-[global_id=wBurgers]-dev.yml 
|   |   |   |   |   |_ sub-[global_id=wBurgers]-stg.yml
|   |   |   |   |   |_ sub-[global_id=wBurgers]-prd.yml

|   |   |   |-- [global_id]=wSoups
|   |   |   |   |-- lib
|   |   |   |   |   |_ sub-[global_id=wSoups].yml 
|   |   |   |   |   |_ sub-[global_id=wSoups].yml
|   |   |   |   |   |_ sub-[global_id=wSoups].yml

|   |   |-- **postConfig**
|   |   |   |-- [global_id]=wTacos
|   |   |   |   |-- lib
|   |   |   |   |   |_ sub-[global_id=wTacos]-dev.yml 
|   |   |   |   |   |_ sub-[global_id=wTacos]-stg.yml 
|   |   |   |   |   |_ sub-[global_id=wTacos]-prd.yml 
|   |   |   |-- [global_id]=wBurgers
|   |   |   |   |-- lib
|   |   |   |   |   |_ sub-[global_id=wBurgers]-dev.yml 
|   |   |   |   |   |_ sub-[global_id=wBurgers]-stg.yml
|   |   |   |   |   |_ sub-[global_id=wBurgers]-prd.yml

|   |   |   |-- [global_id]=wSoups
|   |   |   |   |-- lib
|   |   |   |   |   |_ sub-[global_id=wSoups].yml 
|   |   |   |   |   |_ sub-[global_id=wSoups].yml
|   |   |   |   |   |_ sub-[global_id=wSoups].yml
|-- terraform 
|   |-- vending_module
|   |   |_main.tf
|   |   |_variables.tf
|   |   |_outputs.tf
```